<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>練習遊戲：選擇題＋填充題</title>
  <style>
    :root{
      --card:#ffffff; --bg:#e9f7ff; --ink:#0f172a; --muted:#64748b;
      --good:#16a34a; --bad:#dc2626; --brand:#0ea5e9; --line:#e2e8f0; --soft:#f8fafc;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
      background: linear-gradient(180deg, var(--bg), #ffffff);
      color: var(--ink);
    }
    .wrap{ max-width: 980px; margin:0 auto; padding: 20px; }
    .header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom: 14px; flex-wrap:wrap;
    }
    .title{ display:flex; align-items:center; gap:10px; font-size: 20px; font-weight: 900; }
    .badge{
      font-size: 12px; color: #0369a1; background:#dbeafe;
      padding: 4px 10px; border-radius: 999px; font-weight: 800;
    }
    .stats{ display:flex; gap:10px; align-items:center; color:var(--muted); font-weight: 800; flex-wrap:wrap; }
    .pill{
      background:#f1f5f9; border:1px solid var(--line);
      padding: 6px 10px; border-radius: 999px;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(2, 132, 199, 0.08);
      padding: 16px;
    }
    .sectionTag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius: 999px;
      background:#f1f5f9; border:1px solid var(--line);
      font-weight: 900; color:#0ea5e9; margin-bottom: 10px;
    }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .qno{ color:var(--brand); font-weight: 900; }
    .question{ font-size: 20px; font-weight: 900; line-height: 1.45; margin: 10px 0 14px; }

    .options{ display:grid; gap:10px; margin-top: 8px; }
    button.opt{
      width:100%; text-align:left; padding: 12px 14px;
      border-radius: 14px; border: 1px solid var(--line);
      background: #ffffff; cursor:pointer; font-size: 16px; font-weight: 800;
      display:flex; align-items:flex-start; gap:10px;
      transition: transform .05s ease, border-color .2s ease, background .2s ease;
    }
    button.opt:hover{ border-color:#93c5fd; background: var(--soft); }
    button.opt:active{ transform: scale(0.99); }
    button.opt:disabled{ cursor:not-allowed; opacity: .92; }
    .key{
      flex: 0 0 auto; width: 30px; height: 30px;
      border-radius: 10px; display:inline-grid; place-items:center;
      background:#f1f5f9; border:1px solid var(--line);
      color:var(--ink); font-weight: 900; margin-top: 1px;
    }

    .feedback{
      margin-top: 14px; padding: 12px 14px; border-radius: 14px;
      border: 1px solid var(--line); background: var(--soft);
      display:none; font-weight: 900; line-height: 1.4;
    }
    .feedback.ok{ border-color:#bbf7d0; background:#f0fdf4; color:#166534; display:block; }
    .feedback.no{ border-color:#fecaca; background:#fef2f2; color:#991b1b; display:block; }

    .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top: 14px; flex-wrap:wrap; }
    .btn{
      border: 1px solid var(--line); background: var(--brand); color:white;
      padding: 10px 14px; border-radius: 12px; font-weight: 900; cursor:pointer;
    }
    .btn.secondary{ background:#ffffff; color:var(--ink); }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }

    .progress{ height: 10px; width: 100%; background: var(--line); border-radius: 999px; overflow:hidden; margin-top: 12px; }
    .bar{ height:100%; width:0%; background: linear-gradient(90deg, #22c55e, var(--brand)); transition: width .35s ease; }

    .start{ display:grid; gap:10px; text-align:center; padding: 14px; }
    .big{ font-size: 26px; font-weight: 950; margin: 4px 0 0; }
    .sub{ color:var(--muted); font-weight: 800; margin: 0; }

    .bank{
      display:flex; flex-wrap:wrap; gap:8px;
      padding: 10px; border-radius: 14px;
      border: 1px dashed #cbd5e1;
      background:#f8fafc;
      margin: 10px 0 6px;
    }
    .chip{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background:#fff;
      font-weight: 900;
      color:#0f172a;
      font-size: 13px;
    }
    .chip small{
      font-weight: 800;
      color: var(--muted);
      margin-left: 6px;
    }

    .fillItem{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      padding: 10px; border-radius: 14px; border:1px solid var(--line);
      background:#fff;
    }
    .fillItem b{ color:#0ea5e9; }
    select{
      appearance:none;
      border: 1px solid var(--line);
      background:#fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 900;
      min-width: 160px;
      cursor:pointer;
    }
    select:focus{ outline: 2px solid #93c5fd; outline-offset: 2px; }

    .footer-note{ margin-top:10px; color:var(--muted); font-size: 12px; font-weight: 800; line-height: 1.4; }

    /* ✅ 手機大按鈕 */
    @media (max-width: 600px){
      .wrap{ padding: 14px; }
      .title{ font-size: 18px; }
      .question{ font-size: 22px; }
      button.opt{ font-size: 18px; padding: 18px 16px; border-radius: 16px; }
      .key{ width: 38px; height: 38px; border-radius: 12px; font-size: 16px; }
      .btn{ width: 100%; padding: 14px 16px; font-size: 16px; border-radius: 14px; }
      .actions{ justify-content:stretch; }
      select{ width: 100%; min-width: unset; padding: 14px 12px; }
      .fillItem{ gap:8px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <span>練習遊戲：選擇題＋填充題</span>
        <span class="badge" id="modeBadge">p1 練習</span>
      </div>
      <div class="stats">
        <span class="pill">分數：<span id="score">0</span></span>
        <span class="pill">進度：<span id="progressText">0/0</span></span>
      </div>
    </div>

    <div class="card" id="card"></div>

    <div class="footer-note">
      填充題的辭庫來自你提供的 p2（神話、神祇、部族、權勢、主宰、戰爭、匯流、神權、變動）。
    </div>
  </div>

  <script>
    // ===== p2 辭庫（詞＋拼音）=====
    const WORD_BANK = [
      { zh: "神話", py: "shénhuà" },
      { zh: "神祇", py: "shénzhǐ" },
      { zh: "部族", py: "bùzú" },
      { zh: "權勢", py: "quánshì" },
      { zh: "主宰", py: "zhǔzǎi" },
      { zh: "戰爭", py: "zhànzhēng" },
      { zh: "匯流", py: "huìliú" },
      { zh: "神權", py: "shénquán" },
      { zh: "變動", py: "biàndòng" },
    ];

    // ===== 選擇題（依你圖片內容整理）=====
    // 正確：Q1 b、Q2 a
    const MCQ = [
      {
        q: "下列哪一句使用正確？",
        options: [
          { text: "從去年起，我每天都運動。", correct: false },
          { text: "從去年起，我去過去旅行。", correct: true },
          { text: "從去年起，我昨天吃飯。", correct: false },
        ],
      },
      {
        q: "下列哪一句使用正確？",
        options: [
          { text: "他高興極了，因為考試及格。", correct: true },
          { text: "他高興極了，今天吃了早餐。", correct: false },
          { text: "他高興了，昨天睡覺。", correct: false },
        ],
      },
    ];

    // ===== 填充題（答案對應 p2 辭庫）=====
    const FILL = [
      { before: "很多古老的", after: "都是講神明和英雄的故事。", answer: "神話" },
      { before: "這個", after: "住在同一片土地，有自己的規則和習俗。", answer: "部族" },
      { before: "河流從不同的地方", after: "到大海。", answer: "匯流" },
      { before: "古代部族相信神祇有很大的", after: "。", answer: "神權" },
      { before: "太陽和月亮可以", after: "天空。", answer: "主宰" },
      { before: "王的", after: "比普通百姓更大。", answer: "權勢" },
      { before: "社會的", after: "常常因為戰爭而改變。", answer: "變動" },
    ];

    // ===== 狀態 =====
    let stage = "start";        // start | mcq | fill | end
    let mcqDeck = [];
    let fillDeck = [];
    let mcqIdx = 0;
    let score = 0;

    const $card = document.getElementById("card");
    const $score = document.getElementById("score");
    const $progressText = document.getElementById("progressText");
    const $modeBadge = document.getElementById("modeBadge");

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function resetGame(){
      stage = "start";
      mcqDeck = shuffle(MCQ);
      fillDeck = shuffle(FILL);
      mcqIdx = 0;
      score = 0;
      $score.textContent = score;
      $modeBadge.textContent = "p1 練習";
      $progressText.textContent = `0/${MCQ.length + FILL.length}`;
      renderStart();
    }

    function renderStart(){
      $card.innerHTML = `
        <div class="start">
          <div class="big">準備好了嗎？</div>
          <p class="sub">本遊戲包含：選擇題 ${MCQ.length} 題＋填充題 ${FILL.length} 題</p>
          <p class="sub">答對 +1 分（填充題辭庫來自 p2）</p>
          <div class="actions" style="justify-content:center;">
            <button class="btn" id="startBtn">開始</button>
            <button class="btn secondary" id="reshuffleBtn">重新洗牌</button>
          </div>
        </div>
      `;
      document.getElementById("startBtn").onclick = () => {
        stage = "mcq";
        renderMCQ();
      };
      document.getElementById("reshuffleBtn").onclick = () => resetGame();
    }

    function updateProgress(){
      const done = (stage === "mcq") ? mcqIdx : (stage === "fill") ? MCQ.length : (stage === "end") ? (MCQ.length + FILL.length) : 0;
      $progressText.textContent = `${done}/${MCQ.length + FILL.length}`;
    }

    // ===== 選擇題 =====
    function renderMCQ(){
      updateProgress();
      $modeBadge.textContent = "選擇題";

      const item = mcqDeck[mcqIdx];
      const qno = mcqIdx + 1;

      const opts = shuffle(item.options);
      const keys = ["A", "B", "C"];
      const optionsHTML = opts.map((opt, i) => `
        <button class="opt" data-correct="${opt.correct}">
          <span class="key">${keys[i]}</span>
          <span>${opt.text}</span>
        </button>
      `).join("");

      $card.innerHTML = `
        <div class="sectionTag">選擇題・選出正確的答案</div>

        <div class="row">
          <div class="qno">第 ${qno} 題（選擇）</div>
          <div class="pill" style="color:var(--brand); font-weight:950;">共 ${MCQ.length} 題</div>
        </div>

        <div class="question">${item.q}</div>
        <div class="options">${optionsHTML}</div>

        <div id="feedback" class="feedback"></div>

        <div class="actions">
          <button class="btn secondary" id="skipBtn">跳過</button>
          <button class="btn" id="nextBtn" disabled>下一題</button>
        </div>

        <div class="progress"><div class="bar" id="bar"></div></div>
      `;

      document.getElementById("bar").style.width =
        Math.round((mcqIdx / (MCQ.length + FILL.length)) * 100) + "%";

      let locked = false;
      function disableAll(){
        document.querySelectorAll("button.opt").forEach(b => b.disabled = true);
      }
      function highlightCorrect(){
        document.querySelectorAll("button.opt").forEach(b => {
          if (b.dataset.correct === "true") b.style.borderColor = "var(--good)";
        });
      }

      document.querySelectorAll("button.opt").forEach(btn => {
        btn.onclick = () => {
          if (locked) return;
          locked = true;

          const isCorrect = btn.dataset.correct === "true";
          const fb = document.getElementById("feedback");
          const nextBtn = document.getElementById("nextBtn");

          if (isCorrect){
            score += 1;
            $score.textContent = score;
            fb.className = "feedback ok";
            fb.textContent = "✅ 答對了！+1 分";
          } else {
            fb.className = "feedback no";
            fb.textContent = "❌ 答錯了。";
          }

          disableAll();
          highlightCorrect();
          nextBtn.disabled = false;
        };
      });

      document.getElementById("skipBtn").onclick = () => {
        if (mcqIdx < MCQ.length - 1){
          mcqIdx++;
          renderMCQ();
        } else {
          stage = "fill";
          renderFill();
        }
      };

      document.getElementById("nextBtn").onclick = () => {
        if (mcqIdx < MCQ.length - 1){
          mcqIdx++;
          renderMCQ();
        } else {
          stage = "fill";
          renderFill();
        }
      };
    }

    // ===== 填充題 =====
    function renderFill(){
      $modeBadge.textContent = "填充題";
      updateProgress();

      const bankHTML = WORD_BANK.map(w => `
        <span class="chip">${w.zh}<small>${w.py}</small></span>
      `).join("");

      const itemsHTML = fillDeck.map((it, i) => `
        <div class="fillItem">
          <b>${i+1}.</b>
          <span>${it.before}</span>
          <select class="fillSelect" data-i="${i}">
            <option value="">（請選擇）</option>
          </select>
          <span>${it.after}</span>
        </div>
      `).join("");

      $card.innerHTML = `
        <div class="sectionTag">填充題・填入正確的詞彙（辭庫 p2）</div>

        <div class="row">
          <div class="qno">共 ${FILL.length} 題（填充）</div>
          <div class="pill" style="color:var(--brand); font-weight:950;">每個詞建議只用一次</div>
        </div>

        <div class="bank" aria-label="word bank">${bankHTML}</div>

        <div style="display:grid; gap:10px; margin-top:10px;">
          ${itemsHTML}
        </div>

        <div id="fillFeedback" class="feedback" style="margin-top:12px;"></div>

        <div class="actions">
          <button class="btn secondary" id="backBtn">返回選擇題</button>
          <button class="btn" id="checkBtn">送出檢查</button>
        </div>

        <div class="progress"><div class="bar" id="bar"></div></div>
      `;

      document.getElementById("bar").style.width =
        Math.round((MCQ.length / (MCQ.length + FILL.length)) * 100) + "%";

      const selects = Array.from(document.querySelectorAll(".fillSelect"));

      // 初次填入所有選項
      function rebuildSelectOptions(){
        const chosen = new Set(selects.map(s => s.value).filter(v => v));
        selects.forEach(sel => {
          const current = sel.value;
          sel.innerHTML = `<option value="">（請選擇）</option>` + WORD_BANK.map(w => {
            const disabled = (w.zh !== current && chosen.has(w.zh)) ? "disabled" : "";
            const selected = (w.zh === current) ? "selected" : "";
            return `<option value="${w.zh}" ${disabled} ${selected}>${w.zh}（${w.py}）</option>`;
          }).join("");
        });
      }
      rebuildSelectOptions();
      selects.forEach(sel => sel.onchange = rebuildSelectOptions);

      document.getElementById("backBtn").onclick = () => {
        stage = "mcq";
        renderMCQ();
      };

      document.getElementById("checkBtn").onclick = () => {
        const fb = document.getElementById("fillFeedback");

        // 判斷每題
        let correctCount = 0;
        const results = fillDeck.map((it, i) => {
          const chosen = selects[i].value;
          const ok = chosen === it.answer;
          if (ok) correctCount++;
          return { i: i+1, ok, chosen, answer: it.answer };
        });

        // 加分：每題答對 +1
        // 為避免重複加分：送出後鎖定並一次結算
        const alreadyChecked = document.getElementById("checkBtn").dataset.checked === "true";
        if (!alreadyChecked){
          score += correctCount;
          $score.textContent = score;
          document.getElementById("checkBtn").dataset.checked = "true";
        }

        if (correctCount === fillDeck.length){
          fb.className = "feedback ok";
          fb.textContent = `✅ 太棒了！填充題全對（+${correctCount} 分）`;
        } else {
          fb.className = "feedback no";
          fb.textContent = `❌ 填充題：${correctCount}/${fillDeck.length} 題正確（${alreadyChecked ? "不再重複加分" : `+${correctCount} 分`}）。你可以再調整後重新按一次檢查。`;
        }

        // 顯示每題對錯（不直接給答案也行；這裡採「錯題提示答案」版本，方便教學）
        // 若你想「不顯示答案」，我可以幫你改成只標紅/標綠。
        const detail = results.map(r => r.ok
          ? `第${r.i}題 ✅`
          : `第${r.i}題 ❌ 你選「${r.chosen || "（未選）"}」，正解「${r.answer}」`
        ).join("｜");

        fb.textContent += "\n" + detail;

        // 結束：如果全對或已經檢查過一次也可以進結算（這裡：點完檢查後就出現「完成」按鈕）
        const existing = document.getElementById("finishBtn");
        if (!existing){
          const actions = document.querySelector(".actions");
          const finish = document.createElement("button");
          finish.className = "btn";
          finish.id = "finishBtn";
          finish.textContent = "完成並看結果";
          finish.onclick = () => { stage = "end"; renderEnd(); };
          actions.appendChild(finish);
        }
      };
    }

    // ===== 結束 =====
    function renderEnd(){
      $modeBadge.textContent = "完成";
      $progressText.textContent = `${MCQ.length + FILL.length}/${MCQ.length + FILL.length}`;

      $card.innerHTML = `
        <div class="start">
          <div class="big">完成！</div>
          <p class="sub">你的分數：<b style="color:var(--brand);">${score}</b></p>
          <p class="sub">選擇題 ${MCQ.length} 題＋填充題 ${FILL.length} 題</p>

          <div class="actions" style="justify-content:center;">
            <button class="btn" id="restartBtn">再玩一次</button>
            <button class="btn secondary" id="reshuffleBtn">重新洗牌題目</button>
          </div>
        </div>
      `;
      document.getElementById("restartBtn").onclick = resetGame;
      document.getElementById("reshuffleBtn").onclick = resetGame;
    }

    // init
    resetGame();
  </script>
</body>
</html>
